<Window x:Class="HouseholdAccountBook.Views.Windows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:HouseholdAccountBook.ViewModels"
        xmlns:properties="clr-namespace:HouseholdAccountBook.Properties"
        xmlns:vmw="clr-namespace:HouseholdAccountBook.ViewModels.Windows"
        xmlns:behaviors="clr-namespace:HouseholdAccountBook.Views.Behaviors"
        xmlns:oxy="clr-namespace:OxyPlot.Wpf;assembly=OxyPlot.Wpf"
        xmlns:c="clr-namespace:CalcBinding;assembly=CalcBinding"
        mc:Ignorable="d"
        Title="{x:Static properties:Resources.Title_MainWindow}" Height="700" Width="1050"
        Closing="MainWindow_Closing" StateChanged="MainWindow_StateChanged">
    
    <Window.DataContext>
        <vmw:MainWindowViewModel x:Name="WVM"/>
    </Window.DataContext>

    <Window.Resources>
        <!-- スタイル -->
        <Style x:Key="SummaryStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="#FFEEE3FB"/>
            <Style.Triggers>
                <!-- 分類小計 -->
                <DataTrigger Binding="{Binding ItemId}" Value="-1">
                    <Setter Property="Background" Value="#FFFFFFB0"/>
                </DataTrigger>
                <!-- 収支小計 -->
                <DataTrigger Binding="{Binding CategoryId}" Value="-1">
                    <Setter Property="Background" Value="#FFB0FFB0"/>
                </DataTrigger>
                <!-- 差引損益/残高 -->
                <DataTrigger Binding="{Binding BalanceKind}" Value="-1">
                    <Setter Property="Background" Value="#FFFFB0B0"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DayOfWeekStyle" TargetType="DataGridCell">
            <Style.Triggers>
                <DataTrigger Binding="{Binding ActTime.DayOfWeek}" Value="Saturday">
                    <Setter Property="Foreground" Value="Blue"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding ActTime.DayOfWeek}" Value="Sunday">
                    <Setter Property="Foreground" Value="Red"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding ActTime, Converter={StaticResource DateTimeToIsNationalHolidayConverter}}" Value="true">
                    <Setter Property="Foreground" Value="Red"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Gesture="Alt+F4" Command="{Binding ExitWindowCommand}"/>
        <KeyBinding Gesture="F1" Command="{x:Static ApplicationCommands.Help}"/>
    </Window.InputBindings>
    
    <Grid Background="WhiteSmoke">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.0*"/>
        </Grid.ColumnDefinitions>

        <!-- メニュー -->
        <Menu Grid.Row="0" Grid.Column="0">
            <!-- ファイル -->
            <MenuItem Header="{x:Static properties:Resources.Menu_File}" Command="{Binding FileMenuCommand}">
                <MenuItem Header="{x:Static properties:Resources.Menu_File_Import}">
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Import_KichoFugetsu}" Command="{Binding ImportKichoFugetsuDbCommand}"/>
                    <Separator/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Import_SQLiteFile}" Command="{Binding ImportSQLiteFileCommand}"
                              Visibility="{Binding IsPostgreSQL, Converter={StaticResource BoolVisibilityConverter}}"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Import_PostgreSQL}" Command="{Binding ImportPostgreSQLFileCommand}"
                              Visibility="{Binding IsSQLite, Converter={StaticResource BoolVisibilityConverter}}"/>
                    <Separator/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Import_CustomFormatFile}" Command="{Binding ImportCustomFileCommand}"
                              Visibility="{Binding IsPostgreSQL, Converter={StaticResource BoolVisibilityConverter}}"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Import_SQLiteFile}" Command="{Binding ImportSQLiteFileCommand}"
                              Visibility="{Binding IsSQLite, Converter={StaticResource BoolVisibilityConverter}}"/>
                </MenuItem>
                <MenuItem Header="{x:Static properties:Resources.Menu_File_Export}">
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Export_CustomFormatFile}" Command="{Binding ExportCustomFileCommand}"
                              Visibility="{Binding IsPostgreSQL, Converter={StaticResource BoolVisibilityConverter}}"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Export_SQLFile}" Command="{Binding ExportSQLFileCommand}"
                              Visibility="{Binding IsPostgreSQL, Converter={StaticResource BoolVisibilityConverter}}"/>
                    <Separator Visibility="{Binding IsPostgreSQL, Converter={StaticResource BoolVisibilityConverter}}"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_File_Export_Excel}" Command="{Binding ExportExcelFileCommand}" IsEnabled="False"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_File_Backup}" Command="{Binding BackUpCommand}"/>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_File_Exit}" Command="{Binding ExitWindowCommand}" InputGestureText="Alt+F4"/>
            </MenuItem>
            <!-- 編集 -->
            <MenuItem Header="{x:Static properties:Resources.Menu_Edit}" Command="{Binding BookTabVM.EditMenuCommand}">
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_Find}" Command="{Binding BookTabVM.ShowFindBoxCommand}" InputGestureText="Ctrl+F"/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_Replace}" Command="{Binding BookTabVM.ShowReplaceBoxCommand}" InputGestureText="Ctrl+H"/>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_Move}" Command="{Binding BookTabVM.AddMoveCommand}" InputGestureText="Ctrl+M"/>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_Add}" Command="{Binding BookTabVM.AddActionCommand}" InputGestureText="Ctrl++"/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_AddList}" Command="{Binding BookTabVM.AddActionListCommand}" InputGestureText="Ctrl+Shift++"/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_Copy}" Command="{Binding BookTabVM.CopyCommand}" InputGestureText="Ctrl+Shift+C"/>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_Edit}" Command="{Binding BookTabVM.EditCommand}" InputGestureText="F2"/>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Edit_Delete}" Command="{Binding BookTabVM.DeleteCommand}" InputGestureText="Del"/>
            </MenuItem>
            <!-- 表示 -->
            <MenuItem Header="{x:Static properties:Resources.Menu_View}" Command="{Binding ShowMenuCommand}">
                <MenuItem Header="{x:Static properties:Resources.Menu_View_Book}">
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_Book_Change}" Command="{Binding ShowBookTabCommand}"/>
                    <Separator/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_Book_LastMonth}" Command="{Binding GoToLastMonthCommand}" InputGestureText="Alt+←"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_Book_ThisMonth}" Command="{Binding GoToThisMonthCommand}" InputGestureText="Alt+↓"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_Book_NextMonth}" Command="{Binding GoToNextMonthCommand}" InputGestureText="Alt+→"/>
                    <Separator/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_Book_DailyTermSelection}" Command="{Binding SelectTermCommand}"/>
                </MenuItem>
                <MenuItem Header="{x:Static properties:Resources.Menu_View_DailyGraph}">
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_DailyGraph_Change}" Command="{Binding ShowDailyGraphTabCommand}"/>
                    <Separator/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_DailyGraph_LastMonth}" Command="{Binding GoToLastMonthCommand}" InputGestureText="Alt+←"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_DailyGraph_ThisMonth}" Command="{Binding GoToThisMonthCommand}" InputGestureText="Alt+↓"/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_DailyGraph_NextMonth}" Command="{Binding GoToNextMonthCommand}" InputGestureText="Alt+→"/>
                    <Separator/>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_DailyGraph_DailyTermSelection}" Command="{Binding SelectTermCommand}"/>
                </MenuItem>
                <MenuItem Header="{x:Static properties:Resources.Menu_View_Monthly}">
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList}">
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_Change}" Command="{Binding ShowMonthlyListTabCommand}"/>
                        <Separator/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_LastYear}" Command="{Binding GoToLastYearCommand}" InputGestureText="Alt+←"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_ThisYear}" Command="{Binding GoToThisYearCommand}" InputGestureText="Alt+↓"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_NextYear}" Command="{Binding GoToNextYearCommand}" InputGestureText="Alt+→"/>
                    </MenuItem>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyGraph}">
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyGraph_Change}" Command="{Binding ShowMonthlyGraphTabCommand}"/>
                        <Separator/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyGraph_LastYear}" Command="{Binding GoToLastYearCommand}" InputGestureText="Alt+←"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyGraph_ThisYear}" Command="{Binding GoToThisYearCommand}" InputGestureText="Alt+↓"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyGraph_NextYear}" Command="{Binding GoToNextYearCommand}" InputGestureText="Alt+→"/>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="{x:Static properties:Resources.Menu_View_Yearly}">
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_YearlyList}">
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_YearlyList_Change}" Command="{Binding ShowYearlyListTabCommand}"/>
                        <Separator/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_LastYear}" Command="{Binding GoToLastYearCommand}" InputGestureText="Alt+←"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_ThisYear}" Command="{Binding GoToThisYearCommand}" InputGestureText="Alt+↓"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_NextYear}" Command="{Binding GoToNextYearCommand}" InputGestureText="Alt+→"/>
                    </MenuItem>
                    <MenuItem Header="{x:Static properties:Resources.Menu_View_YearlyGraph}">
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_YearlyGraph_Change}" Command="{Binding ShowYearlyGraphTabCommand}"/>
                        <Separator/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_LastYear}" Command="{Binding GoToLastYearCommand}" InputGestureText="Alt+←"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_ThisYear}" Command="{Binding GoToThisYearCommand}" InputGestureText="Alt+↓"/>
                        <MenuItem Header="{x:Static properties:Resources.Menu_View_MonthlyList_NextYear}" Command="{Binding GoToNextYearCommand}" InputGestureText="Alt+→"/>
                    </MenuItem>
                </MenuItem>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_View_Update}" Command="{Binding UpdateCommand}" InputGestureText="F5"/>
            </MenuItem>
            <!-- ツール -->
            <MenuItem Header="{x:Static properties:Resources.Menu_Tool}" Command="{Binding ToolMenuCommand}">
                <MenuItem Header="{x:Static properties:Resources.Menu_Tool_CsvComparison}" Command="{Binding CompareCsvFileCommand}"/>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Tool_Book}" Command="{Binding ToolInBookCommand}">
                    <MenuItem Header="{x:Static properties:Resources.Menu_Tool_Book_Filter}" IsCheckable="True" IsChecked="{Binding BookTabVM.UseFilter}"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="{x:Static properties:Resources.Menu_Tool_Settings}" Command="{Binding SettingsCommand}"/>
            </MenuItem>
            <!-- ヘルプ -->
            <MenuItem Header="{x:Static properties:Resources.Menu_Help}" Command="{Binding HelpMenuCommand}">
                <MenuItem Header="{x:Static properties:Resources.Menu_Help_VersionInfo}" Command="{Binding ShowVersionCommand}" InputGestureText="F1"/>
            </MenuItem>
        </Menu>

        <TabControl Grid.Row="1" Grid.Column="0" Margin="5" Width="Auto" Height="Auto" TabStripPlacement="Left"
                    SelectedIndex="{Binding SelectedTabIndex}">
            <TabControl.ItemContainerStyle>
                <Style TargetType="TabItem">
                    <Setter Property="Height" Value="75"/>
                </Style>
            </TabControl.ItemContainerStyle>
            <!-- 帳簿 -->
            <TabItem x:Name="_BookTab">
                <TabItem.Header>
                    <TextBlock Text="{x:Static properties:Resources.TabHeader_AccountBook}" TextAlignment="Center"/>
                </TabItem.Header>
                <TabItem.InputBindings>
                    <KeyBinding Gesture="F5" Command="{Binding UpdateCommand}"/>
                    <KeyBinding Gesture="Alt+Up" Command="{Binding ShowMonthlyListTabCommand}"/>
                    <KeyBinding Gesture="Alt+Down" Command="{Binding GoToThisMonthCommand}"/>
                    <KeyBinding Gesture="Alt+Left" Command="{Binding GoToLastMonthCommand}"/>
                    <KeyBinding Gesture="Alt+Right" Command="{Binding GoToNextMonthCommand}"/>

                    <KeyBinding Gesture="Ctrl+F" Command="{Binding BookTabVM.ShowFindBoxCommand}"/>
                    <KeyBinding Gesture="Ctrl+H" Command="{Binding BookTabVM.ShowReplaceBoxCommand}"/>
                </TabItem.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="1.0*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 上部メニュー -->
                    <Grid Grid.Row="0" Grid.Column="0" Margin="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="1.0*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Backward}" Command="{Binding GoToLastMonthCommand}"/>
                            <Button Width="120" Content="{Binding DisplayedMonth, Converter={StaticResource DateTimeToDisplayedMonthConverter}, TargetNullValue={x:Static properties:Resources.Button_DateRange}}"
                                    Command="{Binding SelectTermCommand}">
                                <ToolTipService.ToolTip>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding StartDate, StringFormat='yyyy-MM-dd'}"/>
                                        <TextBlock Grid.Column="1" Text=" - "/>
                                        <TextBlock Grid.Column="2" Text="{Binding EndDate, StringFormat='yyyy-MM-dd'}"/>
                                    </Grid>
                                </ToolTipService.ToolTip>
                            </Button>
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Forward}" Command="{Binding GoToNextMonthCommand}"/>
                            <Button Width="80" Content="{x:Static properties:Resources.Button_ThisMonth}" Command="{Binding GoToThisMonthCommand}">
                                <ToolTipService.ToolTip>
                                    <TextBlock Text="{Binding Now, Source={StaticResource DateTime}, StringFormat={}{0:yyyy-MM}}"/>
                                </ToolTipService.ToolTip>
                            </Button>

                            <ComboBox HorizontalAlignment="Stretch" Margin="3,0" MinWidth="150"
                                      ItemsSource="{Binding BookVMList}" SelectedItem="{Binding SelectedBookVM}" DisplayMemberPath="Name" />
                        </StackPanel>
                            
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Width="50" Margin="0,0,3,0" Content="{x:Static properties:Resources.Button_Move}" Command="{Binding BookTabVM.AddMoveCommand}"/>
                            <Button Width="50" Content="{x:Static properties:Resources.Button_Add}" Command="{Binding BookTabVM.AddActionCommand}"/>
                            <Button Width="80" Content="{x:Static properties:Resources.Button_AddList}" Command="{Binding BookTabVM.AddActionListCommand}"/>
                            <Button Width="50" Content="{x:Static properties:Resources.Button_Copy}" Command="{Binding BookTabVM.CopyCommand}"/>
                            <Button Width="50" Margin="3,0,0,0" Content="{x:Static properties:Resources.Button_Edit}" Command="{Binding BookTabVM.EditCommand}"/>
                            <Button Width="50" Margin="3,0,0,0" Content="{x:Static properties:Resources.Button_Delete}" Command="{Binding BookTabVM.DeleteCommand}"/>
                            <CheckBox Margin="3,3,0,3" ToolTip="{x:Static properties:Resources.ToolTip_CheckIsMatch}" VerticalAlignment="Center"
                                      IsChecked="{Binding BookTabVM.IsMatch, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Command="{Binding BookTabVM.ChangeIsMatchCommand}"/>
                        </StackPanel>
                    </Grid>

                    <!-- データリスト -->
                    <Grid Grid.Row="1" Grid.Column="0" Margin="2" DataContext="{Binding BookTabVM}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.0*" MinWidth="200"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="Auto" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <!-- 帳簿項目リスト -->
                        <Grid Grid.Column="0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="1.0*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <DataGrid x:Name="_actionDataGrid" Grid.Row="0" SelectionMode="Extended"
                                  ItemsSource="{Binding DisplayedActionVMList}" SelectedItem="{Binding SelectedActionVM}" IsReadOnly="True" SelectionUnit="FullRow"
                                  CanUserAddRows="False" CanUserDeleteRows="False" CanUserResizeRows="False" FrozenColumnCount="4"
                                  AutoGenerateColumns="False" CanUserReorderColumns="False" CanUserResizeColumns="True" CanUserSortColumns="True"
                                  HorizontalGridLinesBrush="#FFF0F0F0" VerticalGridLinesBrush="#FFF0F0F0" AlternatingRowBackground="#FFFFFFE0" FontSize="10.5" FontFamily="Meiryo">
                                <DataGrid.Resources>
                                    <vm:BindingProxy x:Key="Proxy" DataContext="{Binding}"/>
                                </DataGrid.Resources>
                                <DataGrid.InputBindings>
                                    <KeyBinding Gesture="Ctrl+M" Command="{Binding AddMoveCommand}"/>
                                    <KeyBinding Gesture="Ctrl+OEMPlus" Command="{Binding AddActionCommand}"/>
                                    <KeyBinding Gesture="Ctrl+Add" Command="{Binding AddActionCommand}"/>
                                    <KeyBinding Gesture="Shift+Ctrl+OEMPlus" Command="{Binding AddActionListCommand}"/>
                                    <KeyBinding Gesture="Shift+Ctrl+Add" Command="{Binding AddActionListCommand}"/>
                                    <KeyBinding Gesture="Ctrl+Shift+C" Command="{Binding CopyCommand}"/>
                                    <KeyBinding Gesture="F2" Command="{Binding EditCommand}"/>
                                    <KeyBinding Gesture="Enter" Command="{Binding EditCommand}"/>
                                    <KeyBinding Gesture="Delete" Command="{Binding DeleteCommand}"/>
                                    
                                    <MouseBinding Gesture="LeftDoubleClick" Command="{Binding EditCommand}"/>
                                </DataGrid.InputBindings>
                                <i:Interaction.Behaviors>
                                    <behaviors:BindSelectedItemsToDataGridBehavior SelectedItems="{Binding SelectedActionVMList}"/>
                                </i:Interaction.Behaviors>
                                <DataGrid.ItemContainerStyle>
                                    <Style TargetType="DataGridRow">
                                        <Setter Property="IsSelected" Value="{Binding SelectFlag, Mode=TwoWay}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsMatch}" Value="True">
                                                <Setter Property="Foreground" Value="Green"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsFuture}" Value="True">
                                                <Setter Property="Foreground" Value="Gray"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGrid.ItemContainerStyle>
                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>
                                <DataGrid.Columns>
                                    <DataGridCheckBoxColumn Header="" Binding="{Binding SelectFlag}"
                                                    Visibility="{Binding App_IsDebug, Source={StaticResource Settings}, Converter={StaticResource BoolVisibilityConverter}}"/>
                                    <DataGridTextColumn Header="Id" Binding="{Binding ActionId}"
                                                    Visibility="{Binding App_IsDebug, Source={StaticResource Settings}, Converter={StaticResource BoolVisibilityConverter}}"/>
                                    <DataGridTextColumn Header="GId" Binding="{Binding GroupId}"
                                                    Visibility="{Binding App_IsDebug, Source={StaticResource Settings}, Converter={StaticResource BoolVisibilityConverter}}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Date}" Binding="{Binding ActTime, StringFormat='yyyy-MM-dd'}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Day}" Binding="{Binding ActTime, Converter={StaticResource DateTimeToDayOfWeekConverter}, ConverterCulture={StaticResource AppCulture}}"
                                                    CellStyle="{StaticResource DayOfWeekStyle}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_BookName}" MinWidth="70" Binding="{Binding BookName}"
                                                    Visibility="{Binding App_IsDebug, Source={StaticResource Settings}, Converter={StaticResource BoolVisibilityConverter}}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_CategoryName}" MinWidth="70" Binding="{Binding CategoryName}"
                                                    Visibility="{Binding App_IsDebug, Source={StaticResource Settings}, Converter={StaticResource BoolVisibilityConverter}}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_ItemName}" MinWidth="70" Binding="{Binding ItemName}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Income}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}" Binding="{Binding Income, Converter={StaticResource IntToMoneyDisplayConverter}}" 
                                                    ElementStyle="{StaticResource TextAlignRight}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Expenses}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}" Binding="{Binding Expenses, Converter={StaticResource IntToMoneyDisplayConverter}}" 
                                                    ElementStyle="{StaticResource TextAlignRight}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Balance}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}" Binding="{Binding Balance, Converter={StaticResource IntToMoneyDisplayConverter}}" 
                                                    ElementStyle="{StaticResource TextAlignRight}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_ShopName}" Width="*" Binding="{Binding ShopName}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Remark}" Width="*" Binding="{Binding Remark}"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <!-- 検索エリア -->
                            <Grid Grid.Row="1" Background="GhostWhite" Visibility="{c:Binding ShowFindBox, FalseToVisibility=Collapsed}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="1.0*"/>
                                    <RowDefinition Height="1.0*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="1.0*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0" Margin="3" Height="20" Width="20" Content="{x:Static properties:Resources.Button_HideReplace}" Command="{Binding HideReplaceBoxCommand}" 
                                        Visibility="{c:Binding ShowReplaceBox, FalseToVisibility=Hidden}"/>
                                <Button Grid.Column="0" Margin="3" Height="20" Width="20" Content="{x:Static properties:Resources.Button_ShowReplace}" Command="{Binding ShowReplaceBoxCommand}"
                                        Visibility="{c:Binding !ShowReplaceBox, FalseToVisibility=Hidden}"/>
                                
                                <Grid Grid.Row="0" Grid.Column="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="FindText"/>
                                        <ColumnDefinition Width="1.0*" SharedSizeGroup="FindInput"/>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="FindButton"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Margin="0,3,3,3">
                                        <TextBlock Text="{x:Static properties:Resources.TextBlock_Search}"/>:
                                    </TextBlock>
                                    <TextBox Grid.Column="1" Margin="0,3,3,3" Text="{Binding FindInputText}"/>
                                    <Button Grid.Column="2" Margin="0,3,3,3" Height="20" Width="20" Content="▶️" Command="{Binding FindActionCommand}"/>
                                </Grid>
                                
                                <Button Grid.Row="0" Grid.Column="2" Margin="0,3,3,3" Height="20" Width="20" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Content="{x:Static properties:Resources.Button_HideFind}" Command="{Binding HideFindBoxCommand}"/>

                                <Grid Grid.Row="1" Grid.Column="1" Visibility="{c:Binding ShowReplaceBox, FalseToVisibility=Collapsed}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="FindText"/>
                                        <ColumnDefinition Width="1.0*" SharedSizeGroup="FindInput"/>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="FindButton"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Margin="0,3,3,3">
                                        <TextBlock Text="{x:Static properties:Resources.TextBlock_Replace}"/>:
                                    </TextBlock>
                                    <TextBox Grid.Column="1" Margin="0,3,3,3" Text="{Binding ReplaceText}"/>
                                    <Button Grid.Column="2" Margin="0,3,3,3" Height="20" Width="20" Content="▶" Command="{Binding ReplaceActionCommand}"/>
                                </Grid>
                            </Grid>
                        </Grid>

                        <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch"/>

                        <!-- サマリーリスト -->
                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="1.0*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <DataGrid Grid.Row="0" ItemsSource="{Binding SummaryVMList}" SelectedItem="{Binding SelectedSummaryVM}" 
                                      IsReadOnly="True" SelectionUnit="FullRow" SelectionMode="Single"
                                      CanUserAddRows="False" CanUserDeleteRows="False" CanUserResizeRows="False"
                                      AutoGenerateColumns="False" CanUserReorderColumns="False" CanUserResizeColumns="True" CanUserSortColumns="True"
                                      HorizontalGridLinesBrush="#FFC0C0C0" VerticalGridLinesBrush="#FFC0C0C0" FontSize="10.5" FontFamily="Meiryo"
                                      ItemContainerStyle="{StaticResource SummaryStyle}">
                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="CId" Binding="{Binding CategoryId}"
                                                         Visibility="{Binding App_IsDebug, Source={StaticResource Settings}, Converter={StaticResource BoolVisibilityConverter}}"/>
                                    <DataGridTextColumn Header="IId" Binding="{Binding ItemId}"
                                                         Visibility="{Binding App_IsDebug, Source={StaticResource Settings}, Converter={StaticResource BoolVisibilityConverter}}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_ItemName}" Binding="{Binding Name}"/>
                                    <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Total}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}" Binding="{Binding Total, Converter={StaticResource IntToMoneyDisplayConverter}}" 
                                                        ElementStyle="{StaticResource TextAlignRight}"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <Grid Grid.Row="1" Background="GhostWhite">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1.0*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Margin="3">
                                    <TextBlock Text="{x:Static properties:Resources.TextBlock_Filter}"/>: 
                                </TextBlock>
                                <CheckBox Grid.Column="1" Margin="3,3,0,3" IsChecked="{Binding UseFilter}"/>
                            </Grid>
                        </Grid>
                    </Grid>

                    <!-- ステータスバー -->
                    <StatusBar Grid.Row="2" Grid.Column="0" Margin="2" DataContext="{Binding BookTabVM}" Background="White">
                        <StatusBarItem HorizontalAlignment="Left">
                            <TextBlock>
                                <TextBlock Text="{x:Static properties:Resources.TextBlock_LastOperatedBookItem}"/>:
                                <TextBlock Text="{Binding ActDateLastEdited, TargetNullValue='-', StringFormat='yyyy-MM-dd'}"/>
                            </TextBlock>
                        </StatusBarItem>
                        <StatusBarItem HorizontalAlignment="Right">
                            <TextBlock>
                                [<TextBlock Text="{x:Static properties:Resources.TextBlock_Selection}"/>] <TextBlock Text="{x:Static properties:Resources.TextBlock_Average}"/>: 
                                <TextBlock Text="{Binding AverageValue, TargetNullValue='--', Converter={StaticResource IntToMoneyDisplayConverter}}"/><TextBlock Text="  "/>
                                <TextBlock Text="{x:Static properties:Resources.TextBlock_DataCount}"/>: 
                                <TextBlock Text="{Binding Count, TargetNullValue='--'}"/><TextBlock Text="  "/>
                                <TextBlock Text="{x:Static properties:Resources.TextBlock_Sum}"/>: 
                                <TextBlock Text="{Binding SumValue, Converter={StaticResource IntToMoneyDisplayConverter}}"/>
                                 (<TextBlock Text="{Binding IncomeSumValue, Converter={StaticResource IntToMoneyDisplayConverter}}"/>, 
                                <TextBlock Text="{Binding ExpensesSumValue, Converter={StaticResource IntToMoneyDisplayConverter}}"/>)
                            </TextBlock>
                        </StatusBarItem>
                    </StatusBar>
                </Grid>
            </TabItem>
            <!-- 日別グラフ -->
            <TabItem x:Name="_DailyGraph">
                <TabItem.Header>
                    <TextBlock Text="{x:Static properties:Resources.TabHeader_DailyGraph}" TextAlignment="Center"/>
                </TabItem.Header>
                <TabItem.InputBindings>
                    <KeyBinding Gesture="F5" Command="{Binding UpdateCommand}"/>
                    <KeyBinding Gesture="Alt+Up" Command="{Binding ShowMonthlyGraphTabCommand}"/>
                    <KeyBinding Gesture="Alt+Down" Command="{Binding GoToThisMonthCommand}"/>
                    <KeyBinding Gesture="Alt+Left" Command="{Binding GoToLastMonthCommand}"/>
                    <KeyBinding Gesture="Alt+Right" Command="{Binding GoToNextMonthCommand}"/>
                </TabItem.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="0.7*" MinHeight="200"/>
                        <RowDefinition Height="5"/>
                        <RowDefinition Height="0.3*" MinHeight="200"/>
                    </Grid.RowDefinitions>

                    <!-- 中央メニュー -->
                    <Grid Grid.Row="0" Margin="2">
                        <StackPanel Orientation="Horizontal">
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Backward}" Command="{Binding GoToLastMonthCommand}"/>
                            <Button Width="120" Content="{Binding DisplayedMonth, Converter={StaticResource DateTimeToDisplayedMonthConverter}, TargetNullValue={x:Static properties:Resources.Button_DateRange}}"
                                    Command="{Binding SelectTermCommand}">
                                <ToolTipService.ToolTip>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding DisplayedStart, StringFormat='yyyy-MM-dd'}"/>
                                        <TextBlock Grid.Column="1" Text=" - "/>
                                        <TextBlock Grid.Column="2" Text="{Binding DisplayedEnd, StringFormat='yyyy-MM-dd'}"/>
                                    </Grid>
                                </ToolTipService.ToolTip>
                            </Button>
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Forward}" Command="{Binding GoToNextMonthCommand}"/>
                            <Button Width="80" Content="{x:Static properties:Resources.Button_ThisMonth}" Command="{Binding GoToThisMonthCommand}">
                                <ToolTipService.ToolTip>
                                    <TextBlock Text="{Binding Now, Source={StaticResource DateTime}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}"/>
                                </ToolTipService.ToolTip>
                            </Button>
                            
                            <ComboBox HorizontalAlignment="Stretch" Margin="3,0" MinWidth="150"
                                      ItemsSource="{Binding BookVMList}" SelectedItem="{Binding SelectedBookVM}" DisplayMemberPath="Name"/>
                            <ComboBox HorizontalAlignment="Stretch" Margin="0" MinWidth="100"
                                      ItemsSource="{Binding GraphKind1Dic}" SelectedValue="{Binding SelectedGraphKind1}" SelectedValuePath="Key" DisplayMemberPath="Value"/>
                            <ComboBox HorizontalAlignment="Stretch" Margin="0" MinWidth="100"
                                      ItemsSource="{Binding GraphKind2Dic}" SelectedValue="{Binding SelectedGraphKind2}" SelectedValuePath="Key" DisplayMemberPath="Value">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedGraphKind1}" Value="BalanceGraph">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <!-- 全体グラフ -->
                    <Grid Grid.Row="1" Margin="2" Background="White" DataContext="{Binding DailyGraphTabVM}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <oxy:PlotView Grid.Row="0" Model="{Binding GraphPlotModel}" Controller="{Binding Controller}"/>
                    </Grid>

                    <GridSplitter Grid.Row="2" HorizontalAlignment="Stretch" Background="GhostWhite"/>

                    <!-- 個別グラフ -->
                    <Grid Grid.Row="3" Margin="2" Background="White" DataContext="{Binding DailyGraphTabVM}">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedGraphKind1, ElementName=WVM}" Value="BalanceGraph">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <StackPanel Orientation="Horizontal">
                                <ComboBox HorizontalAlignment="Stretch" Margin="0" MinWidth="200"
                                          ItemsSource="{Binding GraphSeriesVMList}" SelectedItem="{Binding SelectedGraphSeriesVM}" DisplayMemberPath="DisplayedName"/>
                            </StackPanel>
                        </Grid>
                        <oxy:PlotView Grid.Row="1" Model="{Binding SelectedGraphPlotModel}" Controller="{Binding Controller}"/>
                    </Grid>
                </Grid>
            </TabItem>
            <!-- 月別一覧 -->
            <TabItem x:Name="_MonthlySummary">
                <TabItem.Header>
                    <TextBlock Text="{x:Static properties:Resources.TabHeader_MonthlySummary}" TextAlignment="Center"/>
                </TabItem.Header>
                <TabItem.InputBindings>
                    <KeyBinding Gesture="F5" Command="{Binding UpdateCommand}"/>
                    <KeyBinding Gesture="Alt+Down" Command="{Binding GoToThisYearCommand}"/>
                    <KeyBinding Gesture="Alt+Left" Command="{Binding GoToLastYearCommand}"/>
                    <KeyBinding Gesture="Alt+Right" Command="{Binding GoToNextYearCommand}"/>
                </TabItem.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 中央メニュー -->
                    <Grid Grid.Row="0" Margin="2">
                        <StackPanel Orientation="Horizontal">
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Backward}" Command="{Binding GoToLastYearCommand}"/>
                            <Button Width="120" Content="{Binding DisplayedYear, Converter={StaticResource DateTimeToDisplayedYearConverter}}">
                                <ToolTipService.ToolTip>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding DisplayedStart, StringFormat='yyyy-MM'}"/>
                                        <TextBlock Grid.Column="1" Text=" - "/>
                                        <TextBlock Grid.Column="2" Text="{Binding DisplayedEnd, StringFormat='yyyy-MM'}"/>
                                    </Grid>
                                </ToolTipService.ToolTip>
                            </Button>
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Forward}" Command="{Binding GoToNextYearCommand}"/>
                            <Button Width="80" Content="{x:Static properties:Resources.Button_ThisYear}" Command="{Binding GoToThisYearCommand}">
                                <ToolTipService.ToolTip>
                                    <TextBlock Text="{Binding Now, Source={StaticResource DateTime}, StringFormat={}{0:yyyy}}"/>
                                </ToolTipService.ToolTip>
                            </Button>
                            <ComboBox HorizontalAlignment="Stretch" Margin="3,0" MinWidth="150"
                                          ItemsSource="{Binding BookVMList}" SelectedItem="{Binding SelectedBookVM}" DisplayMemberPath="Name" />
                        </StackPanel>
                    </Grid>

                    <!-- データリスト -->
                    <Grid Grid.Row="1" Margin="2" Background="White" DataContext="{Binding MonthlySummaryTabVM}">
                        <DataGrid Grid.Column="1"
                                  ItemsSource="{Binding SeriesVMList}" SelectedItem="{Binding SelectedSeriesVM}" IsReadOnly="True" SelectionUnit="FullRow"
                                  CanUserAddRows="False" CanUserDeleteRows="False" CanUserResizeRows="False" FrozenColumnCount="1"
                                  AutoGenerateColumns="False" CanUserReorderColumns="False" CanUserResizeColumns="True" CanUserSortColumns="False"
                                  HorizontalGridLinesBrush="#FFC0C0C0" VerticalGridLinesBrush="#FFC0C0C0" FontSize="10.5" FontFamily="Meiryo"
                                  ItemContainerStyle="{StaticResource SummaryStyle}" MouseDoubleClick="MonthlyListDataGrid_MouseDoubleClick">
                            <DataGrid.Resources>
                                <vm:BindingProxy x:Key="Proxy" DataContext="{Binding ElementName=WVM}"/>
                            </DataGrid.Resources>
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <!-- 参考：http://oita.oika.me/2014/05/31/binding-datagridcolumn/ -->
                                <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_ItemName}" Binding="{Binding ListName}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[0], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[0], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[1], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[1], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[2], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[2], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[3], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[3], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[4], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[4], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[5], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[5], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[6], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[6], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[7], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[7], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[8], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[8], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[9], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[9], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[10], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[10], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedMonths[11], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedMonthConverter}}" 
                                                    Binding="{Binding Values[11], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Average}" Binding="{Binding Average, Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Total}" Binding="{Binding Total, Converter={StaticResource IntToMoneyDisplayConverter}}" 
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Grid>
            </TabItem>
            <!-- 月別グラフ -->
            <TabItem x:Name="_MonthlyGraph">
                <TabItem.Header>
                    <TextBlock Text="{x:Static properties:Resources.TabHeader_MonthlyGraph}" TextAlignment="Center"/>
                </TabItem.Header>
                <TabItem.InputBindings>
                    <KeyBinding Gesture="F5" Command="{Binding UpdateCommand}"/>
                    <KeyBinding Gesture="Alt+Down" Command="{Binding GoToThisYearCommand}"/>
                    <KeyBinding Gesture="Alt+Left" Command="{Binding GoToLastYearCommand}"/>
                    <KeyBinding Gesture="Alt+Right" Command="{Binding GoToNextYearCommand}"/>
                </TabItem.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="0.7*" MinHeight="200"/>
                        <RowDefinition Height="5"/>
                        <RowDefinition Height="0.3*" MinHeight="200"/>
                    </Grid.RowDefinitions>

                    <!-- 中央メニュー -->
                    <Grid Grid.Row="0" Margin="2">
                        <StackPanel Orientation="Horizontal">
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Backward}" Command="{Binding GoToLastYearCommand}"/>
                            <Button Width="120" Content="{Binding DisplayedYear, Converter={StaticResource DateTimeToDisplayedYearConverter}}">
                                <ToolTipService.ToolTip>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding DisplayedStart, StringFormat='yyyy-MM'}"/>
                                        <TextBlock Grid.Column="1" Text=" - "/>
                                        <TextBlock Grid.Column="2" Text="{Binding DisplayedEnd, StringFormat='yyyy-MM'}"/>
                                    </Grid>
                                </ToolTipService.ToolTip>
                            </Button>
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Forward}" Command="{Binding GoToNextYearCommand}"/>
                            <Button Width="80" Content="{x:Static properties:Resources.Button_ThisYear}" Command="{Binding GoToThisYearCommand}">
                                <ToolTipService.ToolTip>
                                    <TextBlock Text="{Binding Now, Source={StaticResource DateTime}, Converter={StaticResource DateTimeToDisplayedYearConverter}}"/>
                                </ToolTipService.ToolTip>
                            </Button>
                            
                            <ComboBox HorizontalAlignment="Stretch" Margin="3,0" MinWidth="150"
                                      ItemsSource="{Binding BookVMList}" SelectedItem="{Binding SelectedBookVM}" DisplayMemberPath="Name" />
                            <ComboBox HorizontalAlignment="Stretch" Margin="0" MinWidth="100"
                                      ItemsSource="{Binding GraphKind1Dic}" SelectedValue="{Binding SelectedGraphKind1}" SelectedValuePath="Key" DisplayMemberPath="Value"/>
                            <ComboBox HorizontalAlignment="Stretch" Margin="0" MinWidth="100"
                                      ItemsSource="{Binding GraphKind2Dic}" SelectedValue="{Binding SelectedGraphKind2}" SelectedValuePath="Key" DisplayMemberPath="Value">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedGraphKind1}" Value="BalanceGraph">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <!-- 全体グラフ -->
                    <Grid Grid.Row="1" Margin="2" DataContext="{Binding MonthlyGraphTabVM}" Background="White">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <oxy:PlotView Grid.Row="0" Model="{Binding GraphPlotModel}" Controller="{Binding Controller}"/>
                    </Grid>

                    <GridSplitter Grid.Row="2" HorizontalAlignment="Stretch" Background="GhostWhite"/>
                    
                    <!-- 個別グラフ -->
                    <Grid Grid.Row="3" Margin="2" DataContext="{Binding MonthlyGraphTabVM}" Background="White">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedGraphKind1, ElementName=WVM}" Value="BalanceGraph">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <StackPanel Orientation="Horizontal">
                                <ComboBox HorizontalAlignment="Stretch" MinWidth="200"
                                          ItemsSource="{Binding GraphSeriesVMList}" SelectedItem="{Binding SelectedGraphSeriesVM}" DisplayMemberPath="DisplayedName"/>
                            </StackPanel>
                        </Grid>
                        <oxy:PlotView Grid.Row="1" Model="{Binding SelectedGraphPlotModel}" Controller="{Binding Controller}"/>
                    </Grid>
                </Grid>
            </TabItem>
            <!-- 年別一覧 -->
            <TabItem x:Name="_YearlySummary">
                <TabItem.Header>
                    <TextBlock Text="{x:Static properties:Resources.TabHeader_YearlySummary}" TextAlignment="Center"/>
                </TabItem.Header>
                <TabItem.InputBindings>
                    <KeyBinding Gesture="F5" Command="{Binding UpdateCommand}"/>
                    <KeyBinding Gesture="Alt+Down" Command="{Binding GoToThisYearCommand}"/>
                    <KeyBinding Gesture="Alt+Left" Command="{Binding GoToLastYearCommand}"/>
                    <KeyBinding Gesture="Alt+Right" Command="{Binding GoToNextYearCommand}"/>
                </TabItem.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 中央メニュー -->
                    <Grid Grid.Row="0" Margin="2">
                        <StackPanel Orientation="Horizontal">
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Backward}" Command="{Binding GoToLastYearCommand}"/>
                            <Button Width="120">
                                <Button.Content>
                                    <TextBlock>
                                        <TextBlock Text="{Binding DisplayedStart, Converter={StaticResource DateTimeToDisplayedYearConverter}}"/>
                                        <TextBlock Text=" - "/>
                                        <TextBlock Text="{Binding DisplayedEnd, Converter={StaticResource DateTimeToDisplayedYearConverter}}"/>
                                    </TextBlock>
                                </Button.Content>
                            </Button>
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Forward}" Command="{Binding GoToNextYearCommand}"/>
                            <Button Width="80" Content="{x:Static properties:Resources.Button_LastDecade}" Command="{Binding GoToThisYearCommand}"/>
                            <ComboBox HorizontalAlignment="Stretch" Margin="3,0" MinWidth="150"
                                      ItemsSource="{Binding BookVMList}" SelectedItem="{Binding SelectedBookVM}" DisplayMemberPath="Name"/>
                        </StackPanel>
                    </Grid>

                    <!-- データリスト -->
                    <Grid Grid.Row="1" Margin="2" Background="White" DataContext="{Binding YearlySummaryTabVM}">
                        <DataGrid Grid.Column="1"
                                  ItemsSource="{Binding SeriesVMList}" SelectedItem="{Binding SelectedSeriesVM}" IsReadOnly="True" SelectionUnit="FullRow"
                                  CanUserAddRows="False" CanUserDeleteRows="False" CanUserResizeRows="False" FrozenColumnCount="1"
                                  AutoGenerateColumns="False" CanUserReorderColumns="False" CanUserResizeColumns="True" CanUserSortColumns="False"
                                  HorizontalGridLinesBrush="#FFC0C0C0" VerticalGridLinesBrush="#FFC0C0C0" FontSize="10.5" FontFamily="Meiryo"
                                  ItemContainerStyle="{StaticResource SummaryStyle}" MouseDoubleClick="YearlyListDataGrid_MouseDoubleClick">
                            <DataGrid.Resources>
                                <vm:BindingProxy x:Key="Proxy" DataContext="{Binding ElementName=WVM}"/>
                            </DataGrid.Resources>
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <!-- 参考：http://oita.oika.me/2014/05/31/binding-datagridcolumn/ -->
                                <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_ItemName}" Binding="{Binding ListName}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[0], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[0], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[1], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[1], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[2], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[2], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[3], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[3], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[4], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[4], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[5], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[5], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[6], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[6], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[7], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[7], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[8], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[8], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{Binding DataContext.DisplayedYears[9], Source={StaticResource Proxy}, Converter={StaticResource DateTimeToDisplayedYearConverter}}" 
                                                    Binding="{Binding Values[9], Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Average}" Binding="{Binding Average, Converter={StaticResource IntToMoneyDisplayConverter}}"
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                                <DataGridTextColumn Header="{x:Static properties:Resources.ColumnHeader_Total}" Binding="{Binding Total, Converter={StaticResource IntToMoneyDisplayConverter}}" 
                                                    ElementStyle="{StaticResource TextAlignRight}" Width="{Binding App_ColumnWidth_Value, Source={StaticResource Settings}}"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Grid>
            </TabItem>
            <!-- 年別グラフ -->
            <TabItem x:Name="_YearlyGraph">
                <TabItem.Header>
                    <TextBlock Text="{x:Static properties:Resources.TabHeader_YearlyGraph}" TextAlignment="Center"/>
                </TabItem.Header>
                <TabItem.InputBindings>
                    <KeyBinding Gesture="F5" Command="{Binding UpdateCommand}"/>
                    <KeyBinding Gesture="Alt+Down" Command="{Binding GoToThisYearCommand}"/>
                    <KeyBinding Gesture="Alt+Left" Command="{Binding GoToLastYearCommand}"/>
                    <KeyBinding Gesture="Alt+Right" Command="{Binding GoToNextYearCommand}"/>
                </TabItem.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="0.7*" MinHeight="200"/>
                        <RowDefinition Height="5"/>
                        <RowDefinition Height="0.3*" MinHeight="200"/>
                    </Grid.RowDefinitions>

                    <!-- 中央メニュー -->
                    <Grid Grid.Row="0" Margin="2">
                        <StackPanel Orientation="Horizontal">
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Backward}" Command="{Binding GoToLastYearCommand}"/>
                            <Button Width="120">
                                <Button.Content>
                                    <TextBlock>
                                        <TextBlock Text="{Binding DisplayedStart, Converter={StaticResource DateTimeToDisplayedYearConverter}}"/>
                                        <TextBlock Text=" - "/>
                                        <TextBlock Text="{Binding DisplayedEnd, Converter={StaticResource DateTimeToDisplayedYearConverter}}"/>
                                    </TextBlock>
                                </Button.Content>
                            </Button>
                            <Button Width="20" Content="{x:Static properties:Resources.Button_Forward}" Command="{Binding GoToNextYearCommand}"/>
                            <Button Width="80" Content="{x:Static properties:Resources.Button_LastDecade}" Command="{Binding GoToThisYearCommand}"/>
                            
                            <ComboBox HorizontalAlignment="Stretch" Margin="3,0" MinWidth="150"
                                      ItemsSource="{Binding BookVMList}" SelectedItem="{Binding SelectedBookVM}" DisplayMemberPath="Name"/>
                            <ComboBox HorizontalAlignment="Stretch" Margin="0" MinWidth="100"
                                      ItemsSource="{Binding GraphKind1Dic}" SelectedValue="{Binding SelectedGraphKind1}" SelectedValuePath="Key" DisplayMemberPath="Value"/>
                            <ComboBox HorizontalAlignment="Stretch" Margin="0" MinWidth="100"
                                      ItemsSource="{Binding GraphKind2Dic}" SelectedValue="{Binding SelectedGraphKind2}" SelectedValuePath="Key" DisplayMemberPath="Value">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedGraphKind1}" Value="BalanceGraph">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <!-- 全体グラフ -->
                    <Grid Grid.Row="1" Margin="2" DataContext="{Binding YearlyGraphTabVM}" Background="White">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <oxy:PlotView Grid.Row="0" Model="{Binding GraphPlotModel}" Controller="{Binding Controller}"/>
                    </Grid>

                    <GridSplitter Grid.Row="2" HorizontalAlignment="Stretch" Background="GhostWhite"/>
                    
                    <!-- 個別グラフ -->
                    <Grid Grid.Row="3" Margin="2" DataContext="{Binding YearlyGraphTabVM}" Background="White">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedGraphKind1, ElementName=WVM}" Value="BalanceGraph">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <StackPanel Orientation="Horizontal">
                                <ComboBox HorizontalAlignment="Stretch" MinWidth="200"
                                          ItemsSource="{Binding GraphSeriesVMList}" SelectedItem="{Binding SelectedGraphSeriesVM}" DisplayMemberPath="DisplayedName"/>
                            </StackPanel>
                        </Grid>
                        
                        <oxy:PlotView Grid.Row="1" Model="{Binding SelectedGraphPlotModel}" Controller="{Binding Controller}"/>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
